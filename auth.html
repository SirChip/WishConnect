<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WishConnect - Login/Signup</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        .auth-container {
            max-width: 400px;
            margin: 100px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        footer {
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: 15px 0;
            margin-top: 20px;
        }
        .form-section {
            display: none;
        }
        .active {
            display: block;
        }
        .forgot-password {
            text-align: right;
            margin-top: 10px;
        }
        .forgot-password a {
            color: #4CAF50;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <h2 id="formTitle">Login</h2>

        <!-- Login Form -->
        <form id="loginForm" class="form-section active">
            <input type="email" id="loginEmail" placeholder="Email" required />
            <input type="password" id="loginPassword" placeholder="Password" required />
            <button type="submit">Login</button>
            <div class="forgot-password">
                <a href="#" id="forgotPasswordLink">Forgot Password?</a>
            </div>
        </form>

        <!-- Sign-Up Form -->
        <form id="signupForm" class="form-section">
            <input type="email" id="signupEmail" placeholder="Email" required />
            <input type="password" id="signupPassword" placeholder="Password" required />
            <input type="text" id="paypalUsername" placeholder="Your PayPal Username" required />
            <button type="submit">Sign Up</button>
        </form>

        <!-- Forgot Password Form -->
        <form id="forgotPasswordForm" class="form-section">
            <input type="email" id="resetEmail" placeholder="Enter your email" required />
            <button type="submit">Reset Password</button>
        </form>

        <p id="authMessage"></p>
        <button id="toggleForm">Switch to Sign Up</button>
    </div>
    
    <footer>
        <p>&copy; 2024 WishConnect. All rights reserved.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDFkV0nZx5HCzEPBPdLcqu0aclTLxaaVxs",
            authDomain: "wishconnect-95318.firebaseapp.com",
            projectId: "wishconnect-95318",
            storageBucket: "wishconnect-95318.appspot.com",
            messagingSenderId: "417927480202",
            appId: "1:417927480202:web:28a57312f25e09919a7e73"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Form submissions
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const authMessage = document.getElementById('authMessage');

        // Handle Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Redirect to dashboard
                    window.location.href = 'dashboard.html';
                })
                .catch((error) => {
                    authMessage.textContent = error.message;
                });
        });

        // Handle Sign-Up
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const paypalUsername = document.getElementById('paypalUsername').value;

            createUserWithEmailAndPassword(auth, email, password)
                .then(async (userCredential) => {
                    const user = userCredential.user;
                    // Save user details including PayPal username
                    await setDoc(doc(db, "users", user.uid), { paypalUsername: paypalUsername });
                    // Redirect to dashboard
                    window.location.href = 'dashboard.html';
                })
                .catch((error) => {
                    authMessage.textContent = error.message;
                });
        });

        // Handle Forgot Password
        forgotPasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;

            sendPasswordResetEmail(auth, email)
                .then(() => {
                    authMessage.textContent = "Password reset email sent. Please check your inbox.";
                })
                .catch((error) => {
                    authMessage.textContent = error.message;
                });
        });

        // Switch between Login and Sign-Up forms
        document.getElementById('toggleForm').addEventListener('click', () => {
            loginForm.classList.toggle('active');
            signupForm.classList.toggle('active');
            forgotPasswordForm.classList.remove('active');
            const formTitle = document.getElementById('formTitle');
            formTitle.textContent = loginForm.classList.contains('active') ? "Login" : "Sign Up";
        });

        // Show Forgot Password form
        document.getElementById('forgotPasswordLink').addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.remove('active');
            signupForm.classList.remove('active');
            forgotPasswordForm.classList.add('active');
            document.getElementById('formTitle').textContent = "Reset Password";
        });
    </script>
</body>
</html>
